
<html>
  <head>

    <style>
      div {
        //border: 1px black solid;
        //display: inline-block;
      }

      textarea {
        width: 35%;
        height: 80%;
        display: inline-block;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
      }

    </style>

    <script src="/includetransaction/pushtx.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <script>

      function checkResults(response) {
        var x = response.replace(/.*=/, "");
        //window.setInterval("checkResult(" + ")", 1000);

        var oReq = new XMLHttpRequest();
        oReq.open("GET", "/transactionResult/" + x, true);
        oReq.onload = function () { 
          if(oReq.readyState == 4 && oReq.status == 200) {
            var i, responseText = "";
            var response = JSON.parse(this.responseText); 
            for(i = 0; i < response.length; i++) {
              responseText = responseText + response[i].message + "\n";
            }
            output.value = responseText;
          }
          else {
            output.value = "ERROR!\n" + this.responseText; 
          }
        }
        oReq.send();


      }

      function submitTransaction(theData) {
        var privateKey = '1dd885a423f4e212740f116afa66d40aafdbb3a381079150371801871d9ea281';
        var url = '/includetransaction';
        var value =  0;
      
        api.pushTX(parseInt(nonce.value), 
                   parseInt(gasPrice.value),
	           parseInt(gasLimit.value), 
                   undefined,value,theData,privateKey,url, checkResults);
      
      }

      function compile() {
        //alert('compiling');
        var oReq = new XMLHttpRequest();
        oReq.open("POST", "/solc", true);

        var params = "src=" + input.value;
        oReq.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        //oReq.setRequestHeader("Content-length", params.length);
        //oReq.setRequestHeader("Connection", "close");

        oReq.onload = function () { 
          if(oReq.readyState == 4 && oReq.status == 200) {
            output.value = this.responseText; 
          }
          else {
            output.value = "ERROR!\n" + this.responseText; 
          }
        }

        oReq.send(params);
      }

      function loadAccountInfo() {
	address.value = ''
	address.value = util.privateToAddress(new Buffer(prvkey.value, 'hex')).toString('hex');
        var oReq = new XMLHttpRequest();
        oReq.open("GET", "/query/account?address=" + address.value, true);
        oReq.onload = function () { 
          if(oReq.readyState == 4 && oReq.status == 200) {
	    var responseJSON = JSON.parse(this.responseText);
            if (responseJSON.length >= 1) {
	      nonce.value = responseJSON[responseJSON.length - 1].nonce;
	      if (responseJSON.length > 1) alert("error! too many values in account query, just using the last value.");
	    }
	    else nonce.value = "0";
          }
          else { //returned an error, but no biggie, could just be a malformed form item, etc.
            //output.value = "ERROR in fetching address info!\n" + this.responseText; 
          }
        }

        oReq.send();
      }

    </script>
  
  </head>
  <body>
    <h1>Type your Solidity source code in below</h1>
    <div style="width: 100%">
      <textarea id="input" onchange="compile();" onkeyup="compile()">
	contract qq { }
      </textarea>
      <textarea id="output" style="border: 0px;" readonly="true"></textarea>
    </div>
    <label for="prvkey">Private Key:</label>
    <input id="prvkey" style="width: 300px;" 
	   value="1dd885a423f4e212740f116afa66d40aafdbb3a381079150371801871d9ea281"
	   onkeyup="loadAccountInfo();" /><br>
    <input id="address" style="width: 300px;" />
    <button onclick="submitTransaction(output.value.replace(/(.|\s)*Binary:/m, '').replace(/\s/g, ''))">Press here to submit transaction</button>
    <details>
      <summary>Advanced Options</summary>
      <table style="border: solid; width: 400px; ">
	<tr>
	  <td style="text-align: right;"><label for="gasLimit">Gas Limit:</label></td>
	  <td><input id="gasLimit" value="1000000" style="width: 300px;" /></td>
	</tr>
	<tr>
	  <td style="text-align: right;"><label for="nonce">Gas Price:</label></td>
	  <td><input id="gasPrice" value="100000" style="width: 300px" /></td>
	</tr>
	<tr>
	  <td style="text-align: right;"><label for="nonce">Nonce:</label></td>
	  <td><input id="nonce" value="0" style="width: 300px" /></td>
	</tr>
      </table>
    </details>
    
    
    <script>compile();</script>
  </body>
</html>
